= flash[:notice]

%h1= "Car: #{@car.id}"
%h4= "Status: #{@car.status}"
%h4= "Member: #{@member ? @member.id : 'Available'}"

- #Refactor into partials
%h2 Actions
- if @car.status == 'occupied' && !@car.returning?
  = form_for :transaction, :url => transactions_path do |f|
    = f.date_field :ex_date, placeholder: 'Return Date'
    = f.hidden_field :event_type, value: 'return'
    = f.hidden_field :car_id, value: @car.id
    = f.submit 'Return Vehicle'

  = form_for :transaction, :url => transactions_path do |f|
    = f.hidden_field :event_type, value: 'vacate'
    = f.hidden_field :car_id, value: @car.id
    = f.submit 'Vacate Vehicle'

- elsif @car.status == 'available' 
  = form_for :transaction, :url => transactions_path do |f| 
    = f.date_field :ex_date, placeholder: 'Return Date' 
    = f.hidden_field :event_type, value: 'reserve' 
    = f.hidden_field :car_id, value: @car.id 
    = f.text_field :user_id, placeholder: 'User Id' 
    = f.submit 'Reserve Vehicle' 

  = form_for :transaction, :url => transactions_path do |f|
    = f.hidden_field :event_type, value: 'occupy'
    = f.hidden_field :car_id, value: @car.id
    = f.text_field :user_id, placeholder: 'User Id'
    = f.submit 'Occupy Vehicle'

- elsif @car.returning?
  = form_for :transaction, :url => transactions_path do |f|
    = f.hidden_field :event_type, value: 'vacate'
    = f.hidden_field :car_id, value: @car.id
    = f.submit 'Vacate Vehicle'

- elsif @car.reserved?
  = form_for :transaction, :url => transactions_path do |f| 
    = f.hidden_field :event_type, value: 'occupy' 
    = f.hidden_field :car_id, value: @car.id 
    = f.hidden_field :user_id, value: @car.current_transaction.user_id 
    = f.submit 'Occupy Vehicle' 

%h2 History
%table{border: "1"}
  %tr
    %td Type
    %td Opened Date
    %td User
    %td Closed Date 
  - @transactions.each do |t| 
    %tr
      %td= t.event_type
      %td= t.created_at.to_date
      %td= t.user_id || "NA"
      %td= t.close_date.try(:to_date) || "NA"